<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset=utf-8/>
    <title>GM-N. Carolina</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>

    <!--Scripts-->
    <script src='./scripts/stateData.js'></script>
    <script src='./scripts/NC.js'></script>
    <script src='./scripts/NC_Precincts.js'></script>
    <script src='./scripts/leaflet.ajax.min.js'></script>
    <script src='./scripts/functions.js'></script>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.js"></script>
    <script src="Content/nouislider.js"></script>

    <!--Links-->
    <link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet'/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="Content/Site.css">
    <link rel="stylesheet" href="Content/nouislider.css" >

</head>
<body>

<!--Navbar-->
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand my-navbar-brand"> GerryMender N. Carolina </a>
        </div>
        <a class="text-white navbar-brand toggle-btn" data-toggle="tooltip" data-placement="bottom"
           title="Toggle Menu" onclick="toggleSlider()">Menu <span
                class="glyphicon glyphicon-align-justify"></span></a>
        <a class="text-white navbar-brand" data-toggle="tooltip" data-placement="bottom" title="To Homepage"
           href="Homepage.html" style="float: right">Back</a>
    </div>
</nav>

<!--Map Container-->
<div id="map-container">
    <!--Sliding Menu-->
    <div class="slide-menu active" id="slide-menu">
        <!--Tabs-->
        <div class="tab">
            <button class="tablinks" onclick="openTab(event, 'Help')" 
                data-toggle="tooltip" data-placement="bottom" title ="Shows Help Menu">Help</button>
            <button class="tablinks active" onclick="openTab(event, 'Data')"
                data-toggle="tooltip" data-placement="bottom" title ="Shows Florida Data">Data</button>
            <button class="tablinks" onclick="openTab(event, 'Bloc')"
                data-toggle="tooltip" data-placement="bottom" title ="Shows Bloc Controls">Bloc</button>
            <button class="tablinks" onclick="openTab(event, 'GM')"
                data-toggle="tooltip" data-placement="bottom" title ="Shows Redistricting Controls">Redistrict</button>
        </div>
        <!-- Tab content -->
        <div id="Help" class="tabcontent">
                <div class="tab_header">Need Help?</div>
                <br></br>
                <h4><b>Data:</b>  This tab shows the data for the selected election for this state. Select different elections for different summary data.</h4><br></br>
                <h4><b>Bloc:</b>  This tab determines what precincts in this state are voting as a bloc. Input a threshold for the voting and demographic percentages,
                    hit the calculate button, and view the results.
                </h4>
                <br></br>
                <h4><b>Redistrict:</b>  This tab calculates the maximum number of Minority/Majority districts for this state. It has two phases; for phase one, input
                    the range for the population percentage, and then select to see results either after each iteration, or after the program is finished.
                For phase 2, input the weight of factors for the algorithm to use, select which deographics to consider, and input the desired number of districts. </h4><br></br>
        </div>
        <div id="Data" class="tabcontent">
            <div class="tab_header">Data Displayed
                <span class = "glyphicon glyphicon-question-sign" data-toggle="tooltip" data-placement="bottom"
                      title ="Select an election below for a summary of Florida's voting and demographic data. "></span>
            </div>
                <br>
                <form>
                    <div class="custom-control custom-radio custom-control-inline" style=" margin-left: 30px">
                        <input type="radio" class="custom-control-input" id="2016P" name="example" value="customEx"onclick="show2016CData('NC')">
                        <label class="custom-control-label" for="2016P" style="color: white;">2016 Presidential Election</label>
                    </div>
                    <div class="custom-control custom-radio custom-control-inline" style=" margin-left: 30px">
                        <input type="radio" class="custom-control-input" id="2016C" name="example" value="customEx"onclick="show2016PData('NC')">
                        <label class="custom-control-label" for="2016C" style="color: white;">2016 Congressional Election</label>
                    </div>
                    <div class="custom-control custom-radio custom-control-inline" style=" margin-left: 30px">
                        <input type="radio" class="custom-control-input" id="2018C" name="example" value="customEx" checked="true" onclick="show2018Data('NC')">
                        <label class="custom-control-label" for="2018C" style="color: white;">2018 Congressional Election</label>
                    </div>
                </form>
                <br>
                <div class="tab_subheader">State Information</div>
                <table style="width:100%; font-size: 16px;">
                    <caption>Voting Data</caption>
                    <tr>
                        <th>Party</th>
                        <th>Votes for Party</th>
                        <th>Percentage</th>
                    </tr>
                    <tr>
                        <td >Republican</td>
                        <td id = "votesRepublican">1,846,041</td>
                        <td id = "percentRepublican">50.39%</td>
                    </tr>
                    <tr>
                        <td>Democrat</td>
                        <td id = "votesDemocrat">1,771,061</td>
                        <td id = "percentDemocrat">48.35%</td>
                    </tr>
                </table>
                <br>
                <h4 id = "winParty">Winning Party: Republican</h4>
                <h4 id = "totalVotes">Total Votes: 3,617,102</h4>
                <table style="width:100%;">
                    <caption>Demographic Data</caption>
                    <tr>
                        <th>Demographic</th>
                        <th>Population</th>
                    </tr>
                    <tr>
                        <td>White</td>
                        <td>7,296,313</td>
                    </tr>
                    <tr>
                        <td>African American</td>
                        <td>2,264,726</td>
                    </tr>
                    <tr>
                        <td>Hispanic</td>
                        <td>932,534</td>
                    </tr>
                    <tr>
                        <td>Native American</td>
                        <td>163,962</td>
                    </tr>
                    <tr>
                        <td>Asian</td>
                        <td>286,933</td>
                    </tr>
                    <tr>
                        <td>Total Population:</td>
                        <td>10,247,632</td>
                    </tr>
                </table>
                <br><br>
                <!--((potentially links to state guidelines, incumbent info, and statewide patterns))</-->
            </div>
        <div id="Bloc" class="tabcontent">
            <div class="tab_header">Calculate Voting Blocs
                <span class = "glyphicon glyphicon-question-sign" data-toggle="tooltip" data-placement="bottom"
                      title ="Input a threshold for voting percentage and population to determine which precincts vote as a bloc."></span>
            </div>
            <br></br>
            <div class="tab_subheader">Please Input Values Below:<br></br></div>
            <div class="slider_container">
                Population Threshold: <span id="popThresh_value"></span>%<br>
                    <div id = "popSlider"></div><br>                    
                Voting Threshold: <span id="voteThresh_value"></span>%<br>
                    <div id = "voteSlider"></div><br>
            </div>
            <button class="enableOnInput" id="phase0Button" disabled='disabled' onclick="phase0()">Calculate</button>
            <br></br>
            <div class="tab_subheader">Output:</div>
            <br>
            <h4>Democratic Blocs:</h4><br>
            <script id="demBlocs" type="text/x-jquery-tmpl">
                <tr>
                    <td width="50%">${Attr}</td>
                    <td width="50%">${Amount}</td>
                </tr>
                 </script>
            <table class="table" id="demBlocList">
                <thead>
                <tr>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <h4>Republican Blocs:</h4><br>
            <h4>Other Blocs:</h4><br>
        </div>
        <div id="GM" class="tabcontent">
            <div class="tab_header">Gerrymending
                <span class = "glyphicon glyphicon-question-sign" data-toggle="tooltip" data-placement="bottom"
                      title ="Phase 1 of Redistricting: Put a range of population percentage and update mode (by iteration or one cumulative update)."></span>
            </div>
            <br></br>
            <div class="tab_subheader">Phase 1: Graph Partitioning</div>
            <br></br>
            <div>
                <h4>Please Select an Update Mode:</h4>
                <!--If iterative is selected, then the next button should enable-->
                <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" class="custom-control-input" id="iterate" name="example" value="customEx" onclick="iterateMode()">
                    <label class="custom-control-label" for="iterate" style="color: white" >Iterative</label>
                    <button class="enableOnInput_r" id="iterateButton"  disabled = 'disabled' onclick="nextIteration()">Next Iteration</button>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" class="custom-control-input" id="endUpdate" name="example" value="customEx" onclick="endOnly()">
                    <label class="custom-control-label" for="endUpdate" style="color: white">End Only</label><br></br>
                </div>
                <button class="enableOnInput" id = "phase1Button" disabled='disabled' onclick="phase1()">Start</button>
                <br></br>
                <h4>Output: </h4><br></br>
                <button class="enableOnInput" id = "toPhase2" disabled='disabled' onclick="openTab(event, 'P2')">To Phase 2</button>
                <br></br>
            </div>
        </div>
        <div id="P2" class="tabcontent">
            <!--Phase 2 ONLY should appear one Phase 1 COMPLETES.-->
            <div class="tab_header">Phase 2: </div>
            <div class="tab_header">Simulated Annealing
                <span class = "glyphicon glyphicon-question-sign" data-toggle="tooltip" data-placement="bottom"
                      title ="Provide weights for the measures below, select which populations to consider, and input a desired number of districts to
                    be drawn."></span>
            </div>
            <br><br>
            <h4>Objective Function Weights:</h4>
            <div class="content_centered">
                <select name="Weights">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
                <input type="number" name="popThresh" style="width: 50px; color: black; ">
            </div>
            <h4>Minority Populations Considered:.</h4>
            <div>
                <input type="checkbox" name="afr">African American<br>
                <input type="checkbox" name="nat">Native American<br>
                <input type="checkbox" name="his">Hispanic<br>
                <input type="checkbox" name="asi">Asian<br>
                <input type="checkbox" name="whi">White<br>
            </div>
            <h4>Population Percentages:</h4>
                <div class = "tab_subheader">Range:</div><br>
                    <div id="percentage-slider"></div><br>        
                    Min: <span id = "lower-value"></span><br>
                    Max: <span id= "upper-value"></span>
            <br><br>
            <h4>Desired # of Districts:
                <input type="number" name="districts" style="width: 50px; color: black; float: right"></h4>
            </br>
            <div class="tab_subheader">Output:</div>
            <br></br>
            <p>((To Be Done: GM Scores, Population/Maj-Min Tables))</p>
            <button class="disabled" disabled>Original Districts</button>
            <button class="disabled" disabled>Generated Districts</button>
        </div>
    </div>

    <!--Map-->
    <div id="map"></div>
    <div class="small-info-window" id="small-info-window">
        <script id="smallInfoTemplate" type="text/x-jquery-tmpl">
                <tr>
                    <td width="40%">${Attr}</td>
                    <td width="60%">${Amount}</td>
                </tr>
        </script>
        <table class="table" id="small-info-table">
            <thead>
            <tr>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <!--Information Slider-->
    <div class="slide-info" id="slide-info">
        <h3>Information</h3>
        <!-- -->
        <script id="itemTemplate" type="text/x-jquery-tmpl">
                <tr>
                    <td width="50%">${Attr}</td>
                    <td width="50%">${Amount}</td>
                </tr>
        </script>
        <!-- -->
        <table class="table" id="itemList">
            <thead>
            <tr>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <input type="button" class="button" onclick="closeInfo()" value="Close">
    </div>
</div>
<script>
    /*Variables*/
    L.mapbox.accessToken = 'pk.eyJ1IjoidnF1aW50MjMiLCJhIjoiY2sxMTF0azJhMDFyODNncGJhaW1veG51ayJ9.CvreiQri97EaLXDEP5ahcA';
    var mapboxAccessToken = 'pk.eyJ1IjoidnF1aW50MjMiLCJhIjoiY2sxMTF0azJhMDFyODNncGJhaW1veG51ayJ9.CvreiQri97EaLXDEP5ahcA';

    //Map
    var map = L.mapbox.map('map')
        .setView([35, -80], 7.1)
        .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/streets-v11'));
    map.zoomControl.setPosition('topleft');
    //map.dragging.disable()

    //Popups
    var popup1;

    //Sliders
    var sliderState = 0;
    var infoStat = "null";

    /*geoJson Manipulation*/
    setCurrentState('NC');
    updateState('North Carolina');

    var districts = L.geoJson(ncLayer, { 
        style: function (feature) { return { 
            color: 'black', 
            fillColor: district_color.get(feature.properties.DISTRICT), 
            weight: 1, 
            opacity: 0.8, 
            fillOpacity: 0.5};
        },
        onEachFeature: onEachFeature,
    }).addTo(map);

    var precincts = L.geoJson(NC, {
        style: function (feature) { return {
            color: 'black', 
            fillColor: 'red', 
            weight: 1, 
            opacity: 0.8, 
            fillOpacity: 0.5};
        },
        onEachFeature: onEachFeature,
    });

    map.on('zoomend', function () {
        var zoomlevel = map.getZoom();
        //zoomlevel increases as zoom in
        if (zoomlevel > 8) {
            if (map.hasLayer(districts)) {
                map.removeLayer(districts);
                map.addLayer(precincts);
                setPLayer();
            }
        }
        if (zoomlevel <= 8) {
            if (map.hasLayer(precincts)) {
                map.removeLayer(precincts);
                map.addLayer(districts);
                setDLayer();
            }
        }
    });
</script>
</body>
</html>